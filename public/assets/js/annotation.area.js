(function(a){function B(){return a("<div/>")}var C=Math.abs,n=Math.max,p=Math.min,g=Math.round;a.imgAreaSelect=function(z,d){function O(b){return b+A.left-w.left}function P(b){return b+A.top-w.top}function I(b){return b-A.left+w.left}function J(b){return b-A.top+w.top}function F(b){var a=b||T;b=b||U;return{x1:g(c.x1*a),y1:g(c.y1*b),x2:g(c.x2*a),y2:g(c.y2*b),width:g(c.x2*a)-g(c.x1*a),height:g(c.y2*b)-g(c.y1*b)}}function fa(b,a,d,f,e){var h=e||T;e=e||U;c={x1:g(b/h||0),y1:g(a/e||0),x2:g(d/h||0),y2:g(f/
e||0)};c.width=c.x2-c.x1;c.height=c.y2-c.y1}function L(){x.width()&&(A={left:g(x.offset().left),top:g(x.offset().top)},y=x.innerWidth(),u=x.innerHeight(),A.top+=x.outerHeight()-u>>1,A.left+=x.outerWidth()-y>>1,V=g(d.minWidth/T)||0,W=g(d.minHeight/U)||0,ga=g(p(d.maxWidth/T||16777216,y)),ha=g(p(d.maxHeight/U||16777216,u)),"1.3.2"!=a().jquery||"fixed"!=Z||ia.getBoundingClientRect||(A.top+=n(document.body.scrollTop,ia.scrollTop),A.left+=n(document.body.scrollLeft,ia.scrollLeft)),w=/absolute|relative/.test(Q.css("position"))?
{left:g(Q.offset().left)-Q.scrollLeft(),top:g(Q.offset().top)-Q.scrollTop()}:"fixed"==Z?{left:a(document).scrollLeft(),top:a(document).scrollTop()}:{left:0,top:0},q=O(0),r=P(0),(c.x2>y||c.y2>u)&&$())}function aa(b){if(ba){l.css({left:O(c.x1),top:P(c.y1)}).add(R).width(D=c.width).height(K=c.height);R.add(t).add(s).css({left:0,top:0});t.width(n(D-t.outerWidth()+t.innerWidth(),0)).height(n(K-t.outerHeight()+t.innerHeight(),0));a(m[0]).css({left:q,top:r,width:c.x1,height:u});a(m[1]).css({left:q+c.x1,
top:r,width:D,height:c.y1});a(m[2]).css({left:q+c.x2,top:r,width:y-c.x2,height:u});a(m[3]).css({left:q+c.x1,top:r+c.y2,width:D,height:u-c.y2});D-=s.outerWidth();K-=s.outerHeight();switch(s.length){case 8:a(s[4]).css({left:D>>1}),a(s[5]).css({left:D,top:K>>1}),a(s[6]).css({left:D>>1,top:K}),a(s[7]).css({top:K>>1});case 4:s.slice(1,3).css({left:D}),s.slice(2,4).css({top:K})}if(!1!==b&&(a.imgAreaSelect.keyPress!=ra&&a(document).unbind(a.imgAreaSelect.keyPress,a.imgAreaSelect.onKeyPress),d.keys))a(document)[a.imgAreaSelect.keyPress](a.imgAreaSelect.onKeyPress=
ra);a.browser.msie&&2==t.outerWidth()-t.innerWidth()&&(t.css("margin",0),setTimeout(function(){t.css("margin","auto")},0))}}function ja(b){L();aa(b);f=O(c.x1);e=P(c.y1);h=O(c.x2);k=P(c.y2)}function ka(b,a){d.fadeSpeed?b.fadeOut(d.fadeSpeed,a):b.hide()}function M(b){var a=I(b.pageX-w.left)-c.x1;b=J(b.pageY-w.top)-c.y1;la||(L(),la=!0,l.one("mouseout",function(){la=!1}));v="";d.resizable&&(b<=d.resizeMargin?v="n":b>=c.height-d.resizeMargin&&(v="s"),a<=d.resizeMargin?v+="w":a>=c.width-d.resizeMargin&&
(v+="e"));l.css("cursor",v?v+"-resize":d.movable?"move":"");ca&&ca.toggle()}function sa(b){a("body").css("cursor","");(d.autoHide||0==c.width*c.height)&&ka(l.add(m),function(){a(this).hide()});a(document).unbind("mousemove",ma);l.mousemove(M);d.onSelectEnd(z,F())}function ta(b){if(1!=b.which)return!1;L();v?(a("body").css("cursor",v+"-resize"),f=O(c[/w/.test(v)?"x2":"x1"]),e=P(c[/n/.test(v)?"y2":"y1"]),a(document).mousemove(ma).one("mouseup",sa),l.unbind("mousemove",M)):d.movable?(na=q+c.x1-(b.pageX-
w.left),oa=r+c.y1-(b.pageY-w.top),l.unbind("mousemove",M),a(document).mousemove(ua).one("mouseup",function(){d.onSelectEnd(z,F());a(document).unbind("mousemove",ua);l.mousemove(M)})):x.mousedown(b);return!1}function X(b){G&&(b?(h=n(q,p(q+y,f+C(k-e)*G*(h>f||-1))),k=g(n(r,p(r+u,e+C(h-f)/G*(k>e||-1)))),h=g(h)):(k=n(r,p(r+u,e+C(h-f)/G*(k>e||-1))),h=g(n(q,p(q+y,f+C(k-e)*G*(h>f||-1)))),k=g(k)))}function $(){f=p(f,q+y);e=p(e,r+u);C(h-f)<V&&(h=f-V*(h<f||-1),h<q?f=q+V:h>q+y&&(f=q+y-V));C(k-e)<W&&(k=e-W*(k<
e||-1),k<r?e=r+W:k>r+u&&(e=r+u-W));h=n(q,p(h,q+y));k=n(r,p(k,r+u));X(C(h-f)<C(k-e)*G);C(h-f)>ga&&(h=f-ga*(h<f||-1),X());C(k-e)>ha&&(k=e-ha*(k<e||-1),X(!0));c={x1:I(p(f,h)),x2:I(n(f,h)),y1:J(p(e,k)),y2:J(n(e,k)),width:C(h-f),height:C(k-e)};aa();d.onSelectChange(z,F())}function ma(b){h=/w|e|^$/.test(v)||G?b.pageX-w.left:O(c.x2);k=/n|s|^$/.test(v)||G?b.pageY-w.top:P(c.y2);$();return!1}function Y(b,g){h=(f=b)+c.width;k=(e=g)+c.height;a.extend(c,{x1:I(f),y1:J(e),x2:I(h),y2:J(k)});aa();d.onSelectChange(z,
F())}function ua(b){f=n(q,p(na+(b.pageX-w.left),q+y-c.width));e=n(r,p(oa+(b.pageY-w.top),r+u-c.height));Y(f,e);b.preventDefault();return!1}function pa(){a(document).unbind("mousemove",pa);L();h=f;k=e;$();v="";m.is(":visible")||l.add(m).hide().fadeIn(d.fadeSpeed||0);ba=!0;a(document).unbind("mouseup",da).mousemove(ma).one("mouseup",sa);l.unbind("mousemove",M);d.onSelectStart(z,F())}function da(){a(document).unbind("mousemove",pa).unbind("mouseup",da);ka(l.add(m));a("#noteform").fadeOut(200);fa(I(f),
J(e),I(f),J(e));!this instanceof a.imgAreaSelect&&(d.onSelectChange(z,F()),d.onSelectEnd(z,F()))}function va(b){if(1!=b.which||m.is(":animated"))return!1;L();na=f=b.pageX-w.left;oa=e=b.pageY-w.top;a(document).mousemove(pa).mouseup(da);return!1}function wa(){ja(!1)}function xa(){ya=!0;qa(d=a.extend({classPrefix:"imgareaselect",movable:!0,fadeSpeed:200,borderColor1:"#FFF",borderColor2:"#FFF",borderWidth:"1px",parent:"body",minHeight:40,minWidth:40,resizable:!0,resizeMargin:15,onInit:function(){},onSelectStart:function(){},
onSelectChange:function(){},onSelectEnd:function(){}},d));l.add(m).css({visibility:""});d.show&&(ba=!0,L(),aa(),l.add(m).hide().fadeIn(d.fadeSpeed||0));setTimeout(function(){d.onInit(z,F())},0)}function ea(b,a){for(option in a)void 0!==d[option]&&b.css(a[option],d[option])}function qa(b){b.parent&&(Q=a(b.parent)).append(l.add(m));a.extend(d,b);L();if(null!=b.handles){s.remove();s=a([]);for(S=b.handles?"corners"==b.handles?4:8:0;S--;)s=s.add(B());s.addClass(d.classPrefix+"-handle").css({position:"absolute",
fontSize:0,zIndex:H+1||1});0<=!parseInt(s.css("width"))&&s.width(12).height(12);(E=d.borderWidth)&&s.css({borderWidth:E,borderStyle:"solid"});ea(s,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}T=d.imageWidth/y||1;U=d.imageHeight/u||1;null!=b.x1&&(fa(b.x1,b.y1,b.x2,b.y2),b.show=!b.hide);b.keys&&(d.keys=a.extend({shift:1,ctrl:"resize"},b.keys));m.addClass(d.classPrefix+"-outer");R.addClass(d.classPrefix+"-selection");for(S=0;4>S++;)a(t[S-1]).addClass(d.classPrefix+
"-border"+S);ea(R,{selectionColor:"background-color",selectionOpacity:"opacity"});ea(t,{borderOpacity:"opacity",borderWidth:"border-width"});ea(m,{outerColor:"background-color",outerOpacity:"opacity"});(E=d.borderColor1)&&a(t[0]).css({borderStyle:"solid",borderColor:E});(E=d.borderColor2)&&a(t[1]).css({borderStyle:"dashed",borderColor:E});l.append(R.add(t).add(ca).add(s));a.browser.msie&&((E=m.css("filter").match(/opacity=(\d+)/))&&m.css("opacity",E[1]/100),(E=t.css("filter").match(/opacity=(\d+)/))&&
t.css("opacity",E[1]/100));b.hide?ka(l.add(m)):b.show&&ya&&(ba=!0,l.add(m).fadeIn(d.fadeSpeed||0),ja());G=(za=(d.aspectRatio||"").split(/:/))[0]/za[1];x.add(m).unbind("mousedown",va);if(d.disable||!1===d.enable)l.unbind("mousemove",M).unbind("mousedown",ta),a(window).unbind("resize",wa);else{if(d.enable||!1===d.disable)(d.resizable||d.movable)&&l.mousemove(M).mousedown(ta),a(window).resize(wa);d.persistent||x.add(m).mousedown(va)}d.enable=d.disable=void 0}var x=a(z),ya,l=B(),R=B(),t=B().add(B()).add(B()).add(B()),
m=B().add(B()).add(B()).add(B()),s=a([]),ca,q,r,A={left:0,top:0},y,u,Q,w={left:0,top:0},H=0,Z="absolute",na,oa,T,U,v,V,W,ga,ha,G,ba,f,e,h,k,c={x1:0,y1:0,x2:0,y2:0,width:0,height:0},ia=document.documentElement,N,za,S,E,D,K,la,ra=function(b){var a=d.keys,c,g=b.keyCode;c=isNaN(a.alt)||!b.altKey&&!b.originalEvent.altKey?!isNaN(a.ctrl)&&b.ctrlKey?a.ctrl:!isNaN(a.shift)&&b.shiftKey?a.shift:isNaN(a.arrows)?10:a.arrows:a.alt;if("resize"==a.arrows||"resize"==a.shift&&b.shiftKey||"resize"==a.ctrl&&b.ctrlKey||
"resize"==a.alt&&(b.altKey||b.originalEvent.altKey)){switch(g){case 37:c=-c;case 39:b=n(f,h);f=p(f,h);h=n(b+c,f);X();break;case 38:c=-c;case 40:b=n(e,k);e=p(e,k);k=n(b+c,e);X(!0);break;default:return}$()}else switch(f=p(f,h),e=p(e,k),g){case 37:Y(n(f-c,q),e);break;case 38:Y(f,n(e-c,r));break;case 39:Y(f+p(c,y-I(h)),e);break;case 40:Y(f,e+p(c,u-J(k)));break;default:return}return!1};this.remove=function(){qa({disable:!0});l.add(m).remove()};this.getOptions=function(){return d};this.setOptions=qa;this.getSelection=
F;this.setSelection=fa;this.cancelSelection=da;this.update=ja;for(N=x;N.length;)H=n(H,isNaN(N.css("z-index"))?H:N.css("z-index")),"fixed"==N.css("position")&&(Z="fixed"),N=N.parent(":not(body)");H=d.zIndex||H;a.browser.msie&&x.attr("unselectable","on");a.imgAreaSelect.keyPress=a.browser.msie||a.browser.safari?"keydown":"keypress";a.browser.opera&&(ca=B().css({width:"100%",height:"100%",position:"absolute",zIndex:H+2||2}));l.add(m).css({visibility:"hidden",position:Z,overflow:"hidden",zIndex:H||"0"});
l.css({zIndex:H+2||2});R.add(t).css({position:"absolute",fontSize:0});z.complete||"complete"==z.readyState||!x.is("img")?xa():x.one("load",xa);a.browser.msie&&7<=a.browser.version&&(z.src=z.src)};a.fn.imgAreaSelect=function(g){g=g||{};this.each(function(){a(this).data("imgAreaSelect")?g.remove?(a(this).data("imgAreaSelect").remove(),a(this).removeData("imgAreaSelect")):a(this).data("imgAreaSelect").setOptions(g):g.remove||(void 0===g.enable&&void 0===g.disable&&(g.enable=!0),a(this).data("imgAreaSelect",
new a.imgAreaSelect(this,g)))});return g.instance?a(this).data("imgAreaSelect"):this}})(jQuery);